#
# Copyright (C) 2022 Intel Corporation
#
# SPDX-License-Identifier: MIT
#
# See YaML.md for syntax definition
#
--- #--------------------------------------------------------------------------
type: header
desc: "Intel $OneApi Level-Zero Runtime APIs for Context"
ordinal: "0"
--- #--------------------------------------------------------------------------
type: function
desc: "Creates a context with the given devices."
class: $xContext
name: Create
decl: static
ordinal: "0"
analogue:
    - "**clCreateContext**"
details:
    - "All devices should be from the same platform."
    - "Context is used for resource sharing between all the devices associated with it."
    - "Context also serves for resource isolation such that resources do not cross context boundaries."
    - "The returned context is a reference and must be released with a subsequent call to $xContextRelease."
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function must be thread-safe."
params:
    - type: "uint32_t"
      name: DeviceCount
      desc: |
            [in] the number of devices given in phDevices
    - type: "$x_device_handle_t*"
      name: phDevices
      desc: |
            [in][range(0, DeviceCount)] array of handle of devices.
    - type: $x_context_handle_t*
      name: phContext
      desc: "[out] pointer to handle of context object created"
returns:
    - $X_RESULT_ERROR_OUT_OF_HOST_MEMORY
    - $X_RESULT_ERROR_OUT_OF_DEVICE_MEMORY
--- #--------------------------------------------------------------------------
type: function
desc: "Makes a reference of the context handle indicating it's in use until paired $xContextRelease is called"
class: $xContext
name: Retain
decl: static
ordinal: "0"
analogue:
    - "**clRetainContext**"
details:
    - "It is not valid to use a context handle, which has all of its references released."
    - "The application may call this function from simultaneous threads for the same device."
    - "The implementation of this function should be thread-safe."
params:
    - type: "$x_context_handle_t"
      name: hContext
      desc: |
            [in] handle of the context to get a reference of.
--- #--------------------------------------------------------------------------
type: enum
desc: "Supported memory order capabilities"
class: $xContext
name: $x_memory_order_flags_t
etors:
    - name: RELAXED
      desc: "Memory order relaxed"
      value: "$X_BIT(0)"
    - name: ACQUIRE
      desc: "Memory order acquire"
      value: "$X_BIT(1)"
    - name: RELEASE
      desc: "Memory order release"
      value: "$X_BIT(2)"
    - name: ACQ_REL
      desc: "Memory order acquire-release"
      value: "$X_BIT(3)"
    - name: SEQ_CST
      desc: "Memory order sequentially-consistent"
      value: "$X_BIT(4)"
--- #--------------------------------------------------------------------------
type: enum
desc: "Supported memory scopes"
class: $xContext
name: $x_memory_scope_flags_t
etors:
    - name: WORK_ITEM
      desc: "Memory scope of work-item"
      value: "$X_BIT(0)"
    - name: SUB_GROUP
      desc: "Memory scope of sub-group"
      value: "$X_BIT(1)"
    - name: WORK_GROUP
      desc: "Memory scope of work-group"
      value: "$X_BIT(2)"
    - name: DEVICE
      desc: "Memory scope of device"
      value: "$X_BIT(3)"
    - name: SYSTEM
      desc: "Memory scope of system"
      value: "$X_BIT(4)"
--- #--------------------------------------------------------------------------
type: enum
desc: "Supported context info"
class: $xContext
name: $x_context_info_t
etors:
    - name: NUM_DEVICES
      value: "1"
      desc: "[uint32_t] The number of the devices in the context"
    - name: DEVICES
      value: "2"
      desc: "[$x_device_handle_t...] The array of the device handles in the context"
    - name: REFERENCE_COUNT
      value: "3"
      desc: "[uint32_t] The reference count of the context"
    - name: ATOMIC_MEMORY_ORDER_CAPABILITIES
      value: "4"
      desc: "[$x_memory_order_flags_t] Supported memory order capabilities"
    - name: ATOMIC_MEMORY_SCOPE_CAPABILITIES
      value: "5"
      desc: "[$x_memory_scope_flags_t] Supported memory scopes"
--- #--------------------------------------------------------------------------
type: function
desc: "Releases the context handle reference indicating end of its usage"
class: $xContext
name: Release
decl: static
ordinal: "0"
analogue:
    - "**clReleaseContext**"
details:    
    - "The application may call this function from simultaneous threads for the same context."
    - "The implementation of this function should be thread-safe."
params:
    - type: "$x_context_handle_t"
      name: hContext
      desc: |
            [in] handle of the context to release.
--- #--------------------------------------------------------------------------
type: function
desc: "Retrieves various information about context"
class: $xContext
name: GetInfo
decl: static
ordinal: "0"
analogue:
    - "**clGetContextInfo**"
details:
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: $x_context_handle_t
      name: hContext
      desc: "[in] handle of the context"
    - type: $x_context_info_t
      name: ContextInfoType
      desc: "[in] type of the info to retrieve"
    - type: "size_t"
      name: propSize
      desc: |
            [in] the number of bytes of memory pointed to by pContextInfo.
    - type: "void*"
      name: pContextInfo
      desc: |
            [out][optional] array of bytes holding the info.
            if propSize is not equal to or greater than the real number of bytes needed to return 
            the info then the $X_RESULT_ERROR_INVALID_SIZE error is returned and pContextInfo is not used.
    - type: "size_t*"
      name: pPropSizeRet
      desc: |
            [out][optional] pointer to the actual size in bytes of data queried by ContextInfoType.
--- #--------------------------------------------------------------------------
type: function
desc: "Return platform native context handle."
class: $xContext
name: GetNativeHandle
decl: static
ordinal: "0"
details:
    - "Retrieved native handle can be used for direct interaction with the native platform driver."
    - "Use interoperability platform extensions to convert native handle to native type."
    - "The application may call this function from simultaneous threads for the same context."
    - "The implementation of this function should be thread-safe."
params:
    - type: "$x_context_handle_t"
      name: hContext
      desc: |
            [in] handle of the context.
    - type: $x_native_handle_t*
      name: phNativeContext
      desc: |
            [out] a pointer to the native handle of the context.
--- #--------------------------------------------------------------------------
type: function
desc: "Create runtime context object from native context handle."
class: $xContext
name: CreateWithNativeHandle
decl: static
ordinal: "0"
details:
    - "Creates runtime context handle from native driver context handle."
    - "The application may call this function from simultaneous threads for the same context."
    - "The implementation of this function should be thread-safe."
params:
    - type: $x_native_handle_t
      name: hNativeContext
      desc: |
            [in] the native handle of the context.
    - type: "$x_context_handle_t*"
      name: phContext
      desc: |
            [out] pointer to the handle of the context object created.
--- #--------------------------------------------------------------------------
type: fptr_typedef
desc: "Context's extended deleter callback function with user data."
name: $x_context_extended_deleter_t
return: void
params:
    - type: void*
      name: pUserData
      desc: "[in][out] pointer to data to be passed to callback"
--- #--------------------------------------------------------------------------
type: function
desc: "Call extended deleter function as callback."
class: $xContext
name: SetExtendedDeleter
decl: static
ordinal: "0"
details:
    - "Calls exnteded deleter, a user-defined callback to delete context on some platforms."
    - "This is done for performance reasons."
    - "This API might be called directly by an application instead of a runtime backend."
    - "The application may call this function from simultaneous threads for the same context."
    - "The implementation of this function should be thread-safe."
params:
    - type: $x_context_handle_t
      name: hContext
      desc: |
            [in] handle of the context.
    - type: $x_context_extended_deleter_t
      name: pfnDeleter
      desc: |
            [in] Function pointer to extended deleter.
    - type: void*
      name: pUserData
      desc: "[in][out] pointer to data to be passed to callback."
